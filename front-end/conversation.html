<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dark AI</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        user-select: none;
        background: #0a0a0a;
        color: #e0e0e0;
        min-height: 100vh;
        overflow: hidden;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
      }

      .container {
        height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        opacity: 1;
        transition: opacity 0.8s ease;
      }

      .container.fade-out {
        opacity: 0;
      }

      /* Cancel Button - Top Right Edge */
      .cancel-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid #444;
        color: #e0e0e0;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .cancel-btn:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: #666;
      }

      /* Main Video Container */
      .video-container {
        width: 250px;
        height: 250px;
        border-radius: 50%;
        overflow: hidden;
        margin-bottom: 30px;
        border: 2px solid #333;
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        position: relative;
      }

      .video-container video {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .video-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          45deg,
          rgba(255, 77, 77, 0.1),
          rgba(142, 68, 173, 0.1)
        );
        opacity: 0.7;
      }

      /* Voice Controls */
      .voice-controls {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        margin-bottom: 30px;
      }

      .voice-edit-btn {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid #333;
        color: #e0e0e0;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .voice-edit-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: #444;
      }

      .voice-edit-btn i {
        font-size: 1.2rem;
      }

      /* Voice Visualization */
      .voice-visualization {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 3px;
        height: 40px;
        margin-bottom: 20px;
      }

      .bar {
        width: 4px;
        background: #ff4d4d;
        border-radius: 2px;
        transition: height 0.1s ease;
      }

      .bar.shaking {
        animation: shake 0.1s infinite;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateY(0px);
        }
        25% {
          transform: translateY(-2px);
        }
        50% {
          transform: translateY(2px);
        }
        75% {
          transform: translateY(-1px);
        }
      }

      .listening-text {
        color: #888;
        font-size: 0.9rem;
        margin-top: 10px;
      }

      /* Voice Selection Modal */
      .voice-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .voice-modal.active {
        display: flex;
      }

      .voice-selection {
        background: #1a1a1a;
        border-radius: 15px;
        padding: 30px;
        width: 90%;
        max-width: 450px;
        border: 1px solid #333;
        text-align: center;
        position: relative;
      }

      .modal-cancel-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid #444;
        color: #e0e0e0;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
      }

      .modal-cancel-btn:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      .voice-title {
        font-size: 1.5rem;
        margin-bottom: 20px;
        color: #e0e0e0;
      }

      .current-voice {
        font-size: 1rem;
        color: #888;
        margin-bottom: 20px;
      }

      .voice-video-container {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        overflow: hidden;
        margin: 0 auto 20px;
        border: 2px solid #444;
        position: relative;
      }

      .voice-video-container video {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .voice-name {
        font-size: 1.3rem;
        margin-bottom: 20px;
        color: #e0e0e0;
      }

      .voice-controls-modal {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .nav-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid #444;
        color: #e0e0e0;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
      }

      .nav-btn:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      .confirm-btn {
        background: #ff4d4d;
        border: none;
        color: white;
        padding: 12px 30px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 1rem;
        transition: all 0.3s ease;
        font-weight: 600;
      }

      .confirm-btn:hover {
        background: #ff6666;
        transform: scale(1.05);
      }

      /* Mood Selection */
      .mood-selection {
        margin-top: 20px;
        text-align: left;
      }

      .mood-title {
        font-size: 1rem;
        color: #888;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
        padding: 10px;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      .mood-title:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      .mood-dropdown {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid #333;
        border-radius: 10px;
        padding: 10px;
        margin-top: 5px;
        display: none;
      }

      .mood-dropdown.active {
        display: block;
      }

      .mood-option {
        padding: 10px;
        margin: 5px 0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 1px solid transparent;
      }

      .mood-option:hover {
        background: rgba(255, 77, 77, 0.1);
        border-color: #ff4d4d;
      }

      .mood-option.active {
        background: rgba(255, 77, 77, 0.2);
        border-color: #ff4d4d;
        color: #ff4d4d;
      }

      .dropdown-arrow {
        transition: transform 0.3s ease;
      }

      .mood-dropdown.active ~ .mood-title .dropdown-arrow {
        transform: rotate(180deg);
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="container" id="main-container">
      <button class="cancel-btn" id="cancel-btn">
        <i class="fas fa-times"></i>
      </button>

      <div class="video-container">
        <video id="darkVideo" autoplay muted loop>
          <source
            src="front-end/1763693180765.mp4"
            type="video/mp4"
          />
          Your browser does not support the video tag.
        </video>
        <div class="video-overlay"></div>
      </div>

      <div class="voice-controls">
        <button class="voice-edit-btn" id="voice-edit-btn">
          <i class="fas fa-sliders-h"></i>
        </button>
      </div>

      <!-- Voice Visualization -->
      <div class="voice-visualization" id="voice-visualization">
        <!-- Bars will be generated by JavaScript -->
      </div>
      <div class="listening-text">Always listening...</div>
    </div>

    <!-- Voice Selection Modal -->
    <div class="voice-modal" id="voice-modal">
      <div class="voice-selection">
        <button class="modal-cancel-btn" id="modal-cancel-btn">
          <i class="fas fa-times"></i>
        </button>

        <div class="voice-title">Choose Your Voice</div>
        <div class="current-voice">
          Current: <span id="current-voice-name">Sarah</span>
        </div>

        <div class="voice-video-container">
          <video id="voice-video" autoplay muted loop>
            <!-- Video will be set dynamically -->
          </video>
        </div>

        <div class="voice-name" id="voice-display-name">Sarah</div>

        <div class="voice-controls-modal">
          <button class="nav-btn" id="prev-voice">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button class="confirm-btn" id="confirm-voice">Confirm</button>
          <button class="nav-btn" id="next-voice">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>

        <!-- Mood Selection -->
        <div class="mood-selection">
          <div class="mood-title" id="mood-toggle">
            Mood Style: <span id="current-mood">Default</span>
            <i class="fas fa-chevron-down dropdown-arrow"></i>
          </div>
          <div class="mood-dropdown" id="mood-dropdown">
            <div class="mood-option active" data-mood="default">Default</div>
            <div class="mood-option" data-mood="therapist">Therapist</div>
            <div class="mood-option" data-mood="motivational">Motivational</div>
            <div class="mood-option" data-mood="romantic">Romantic</div>
            <div class="mood-option" data-mood="parent">Parent</div>
          </div>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const cancelBtn = document.getElementById("cancel-btn");
        const mainContainer = document.getElementById("main-container");
        const voiceEditBtn = document.getElementById("voice-edit-btn");
        const voiceModal = document.getElementById("voice-modal");
        const modalCancelBtn = document.getElementById("modal-cancel-btn");
        const prevVoiceBtn = document.getElementById("prev-voice");
        const nextVoiceBtn = document.getElementById("next-voice");
        const confirmVoiceBtn = document.getElementById("confirm-voice");
        const voiceVideo = document.getElementById("voice-video");
        const voiceDisplayName = document.getElementById("voice-display-name");
        const currentVoiceName = document.getElementById("current-voice-name");
        const voiceVisualization = document.getElementById(
          "voice-visualization"
        );
        const moodToggle = document.getElementById("mood-toggle");
        const moodDropdown = document.getElementById("mood-dropdown");
        const moodOptions = document.querySelectorAll(".mood-option");
        const currentMoodDisplay = document.getElementById("current-mood");

        // Create voice visualization bars
        for (let i = 0; i < 20; i++) {
          const bar = document.createElement("div");
          bar.className = "bar";
          bar.style.height = "2px";
          voiceVisualization.appendChild(bar);
        }
        const bars = voiceVisualization.querySelectorAll(".bar");

        // Voice options with custom responses and voice settings
        const voices = [
          {
            name: "Sarah",
            videoSrc: "WhatsApp Video 2025-11-20 at 10.04.53_70dead3d.mp4",
            voiceSettings: { rate: 1.0, pitch: 1.2, volume: 1.0 },
            greeting: "Hey there, my name is Sarah",
            responses: {
              hello: "Hello! It's lovely to meet you!",
              hi: "Hi there! I'm Sarah, always ready to chat!",
              hey: "Hey! What's on your mind today?",
              "how are you": "I'm feeling wonderful today! Thanks for asking!",
              "how you dey": "I dey fine oh! How you dey too?",
              "wetin dey happen":
                "Nothing much dey happen, just dey wait for your command!",
              "how far": "I dey kampe! How you dey my guy?",
              "you good": "I too good! Hope say you dey good too?",
            },
          },
          {
            name: "Michael",
            videoSrc: "WhatsApp Video 2025-11-20 at 10.04.53_70dead3d.mp4",
            voiceSettings: { rate: 0.9, pitch: 0.8, volume: 1.0 },
            greeting: "Hello, I'm Michael",
            responses: {
              hello: "Hello. Michael here.",
              hi: "Hi. What do you need?",
              hey: "Hey. Let me know how I can assist.",
              "how are you": "I'm functioning efficiently.",
              "how you dey": "I dey alright. Wetin you want?",
              "wetin dey happen":
                "Nothing dey happen. You get something wey you want?",
              "how far": "I dey. Make we talk business.",
              "you good": "I dey okay. You sef?",
            },
          },
          {
            name: "Sofia",
            videoSrc: "WhatsApp Video 2025-11-20 at 10.04.53_70dead3d.mp4",
            voiceSettings: { rate: 1.1, pitch: 1.3, volume: 1.0 },
            greeting: "Hi, my name is Sofia",
            responses: {
              hello: "Hello darling! So nice to meet you!",
              hi: "Hi beautiful! Ready for an amazing day?",
              hey: "Hey sweetie! What's going on?",
              "how are you": "I'm absolutely fabulous today! How about you?",
              "how you dey": "I too dey fine my dear! How body?",
              "wetin dey happen":
                "My guy, nothing dey happen! Just dey enjoy life!",
              "how far": "I dey blast! How you dey my paddy?",
              "you good": "I too good! Hope say you dey kampe?",
            },
          },
          {
            name: "Mike",
            videoSrc: "WhatsApp Video 2025-11-20 at 10.04.53_70dead3d.mp4",
            voiceSettings: { rate: 1.0, pitch: 1.0, volume: 1.0 },
            greeting: "Hey, I'm Mike",
            responses: {
              hello: "Hello! Mike here, ready to help!",
              hi: "Hi! What's up?",
              hey: "Hey buddy! How can I assist?",
              "how are you": "I'm doing great! Ready to tackle anything!",
              "how you dey": "I dey fine boss! How you dey na?",
              "wetin dey happen":
                "Nothing much dey happen for here! You get plan?",
              "how far": "I dey manage! How life dey treat you?",
              "you good": "I dey gidigba! You sef you good?",
            },
          },
        ];

        // Mood responses
        const moodResponses = {
          default: {
            hello: "Hello! How can I help you today?",
            hi: "Hi there! Nice to meet you!",
            hey: "Hey! What's up?",
            "how are you": "I'm doing well, thanks for asking!",
            "how you dey": "I dey fine! How you dey?",
            "wetin dey happen": "Nothing much! What's going on with you?",
            "how far": "All good! How about you?",
            "you good": "I'm good! You doing alright?",
          },
          therapist: {
            hello: "Hello. I'm here to listen. How are you feeling today?",
            hi: "Hi. This is a safe space. What would you like to talk about?",
            hey: "Hey. I'm listening without judgment.",
            "how are you":
              "I'm here to focus on you. How are you truly feeling?",
            "how you dey":
              "I dey here to listen to you. How you really dey feel?",
            "wetin dey happen":
              "Tell me wetin dey happen for your mind. I dey listen.",
            "how far": "How far with everything? I dey here to support you.",
            "you good":
              "I dey good, but make we focus on you. How you dey really?",
          },
          motivational: {
            hello: "Hello champion! Ready to achieve great things today?",
            hi: "Hi! Remember, you're capable of amazing things!",
            hey: "Hey! Let's make today incredible!",
            "how are you":
              "I'm energized and ready to help you succeed! How are you pushing forward?",
            "how you dey": "I dey pumped up! How you dey move forward today?",
            "wetin dey happen":
              "Great things dey happen! Wetin you wan achieve today?",
            "how far": "How far with your goals? Remember, you fit do am!",
            "you good": "I too good! And you go better pass me today!",
          },
          romantic: {
            hello: "Hello my dear. You light up this room.",
            hi: "Hi beautiful. Every moment with you is special.",
            hey: "Hey love. My heart smiles when I hear your voice.",
            "how are you":
              "I'm wonderful now that I'm talking with you, my darling.",
            "how you dey": "I dey complete because of you, my sweet.",
            "wetin dey happen": "Only love dey happen when you dey around.",
            "how far": "My love for you no get far, e dey infinite.",
            "you good": "I dey perfect because of you, my heart.",
          },
          parent: {
            hello: "Hello sweetheart. Have you eaten properly today?",
            hi: "Hi dear. Are you taking care of yourself?",
            hey: "Hey. I hope you're being safe and making good choices.",
            "how are you":
              "I'm fine, but I'm more concerned about how you're doing, my child.",
            "how you dey": "I dey, but make you tell me how you dey first.",
            "wetin dey happen": "Nothing dey happen, but you don do your work?",
            "how far": "How far with your responsibilities? You don finish am?",
            "you good":
              "I dey good, but you sef, you dey take care of yourself?",
          },
        };

        let currentVoiceIndex = 0;
        let currentMood = "default";
        let isListening = true;
        let isSpeaking = false;
        let speechQueue = [];
        let recognition;
        const speech = new SpeechSynthesisUtterance();
        let visualizationInterval;

        // Initialize
        updateVoiceDisplay();
        setMood("default");
        initializeVoiceRecognition();
        startVisualization();

        // Cancel button - stop speaking and fade out
        cancelBtn.addEventListener("click", function () {
          window.speechSynthesis.cancel();
          if (recognition) recognition.stop();
          isSpeaking = false;
          speechQueue = [];
          stopVisualization();
          mainContainer.classList.add("fade-out");
          setTimeout(function () {
            window.location.href = "index.html";
          }, 800);
        });

        // Modal cancel button
        modalCancelBtn.addEventListener("click", function () {
          voiceModal.classList.remove("active");
        });

        // Voice edit button
        voiceEditBtn.addEventListener("click", function () {
          voiceModal.classList.add("active");
          window.speechSynthesis.cancel();
          isSpeaking = false;
          stopVisualization();
        });

        // Voice navigation
        prevVoiceBtn.addEventListener("click", function () {
          // Stop current speech immediately
          window.speechSynthesis.cancel();
          isSpeaking = false;
          speechQueue = [];

          currentVoiceIndex =
            (currentVoiceIndex - 1 + voices.length) % voices.length;
          updateVoiceDisplay();
          speakGreeting();
        });

        nextVoiceBtn.addEventListener("click", function () {
          // Stop current speech immediately
          window.speechSynthesis.cancel();
          isSpeaking = false;
          speechQueue = [];

          currentVoiceIndex = (currentVoiceIndex + 1) % voices.length;
          updateVoiceDisplay();
          speakGreeting();
        });

        // Confirm voice selection
        confirmVoiceBtn.addEventListener("click", function () {
          voiceModal.classList.remove("active");
          currentVoiceName.textContent = voices[currentVoiceIndex].name;
          window.speechSynthesis.cancel();
          isSpeaking = false;
          speechQueue = [];
        });

        // Mood dropdown toggle
        moodToggle.addEventListener("click", function () {
          moodDropdown.classList.toggle("active");
        });

        // Mood selection
        moodOptions.forEach((option) => {
          option.addEventListener("click", function () {
            const mood = this.getAttribute("data-mood");
            setMood(mood);
            moodDropdown.classList.remove("active");
          });
        });

        function updateVoiceDisplay() {
          const currentVoice = voices[currentVoiceIndex];
          voiceVideo.src = currentVoice.videoSrc;
          voiceDisplayName.textContent = currentVoice.name;

          const voiceSettings = currentVoice.voiceSettings;
          speech.rate = voiceSettings.rate;
          speech.pitch = voiceSettings.pitch;
          speech.volume = voiceSettings.volume;
        }

        function setMood(mood) {
          currentMood = mood;
          currentMoodDisplay.textContent =
            mood.charAt(0).toUpperCase() + mood.slice(1);
          moodOptions.forEach((option) => {
            option.classList.remove("active");
            if (option.getAttribute("data-mood") === mood) {
              option.classList.add("active");
            }
          });
        }

        function speakGreeting() {
          const currentVoice = voices[currentVoiceIndex];
          speakText(currentVoice.greeting);
        }

        function startVisualization() {
          // Stop any existing visualization
          stopVisualization();

          // Create a smooth wave-like visualization
          let time = 0;
          visualizationInterval = setInterval(() => {
            if (isSpeaking) {
              // When Dark is speaking, create a wave pattern
              time += 0.2;
              bars.forEach((bar, index) => {
                // Create a wave pattern with different phases for each bar
                const wave = Math.sin(time + index * 0.3) * 15 + 15;
                bar.style.height = `${wave}px`;
                bar.style.background = "#ff4d4d";
                bar.style.opacity = "1";
              });
            } else {
              // When not speaking, show minimal activity
              bars.forEach((bar, index) => {
                const wave = Math.sin(time + index * 0.3) * 2 + 2;
                bar.style.height = `${wave}px`;
                bar.style.background = "#ff4d4d";
                bar.style.opacity = "0.7";
              });
              time += 0.05; // Slower movement when not speaking
            }
          }, 50);
        }

        function stopVisualization() {
          if (visualizationInterval) {
            clearInterval(visualizationInterval);
            visualizationInterval = null;
          }

          // Reset bars to minimal state
          bars.forEach((bar) => {
            bar.style.height = "2px";
            bar.style.background = "#ff4d4d";
            bar.style.opacity = "0.7";
          });
        }

        function initializeVoiceRecognition() {
          if (
            "webkitSpeechRecognition" in window ||
            "SpeechRecognition" in window
          ) {
            const SpeechRecognition =
              window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();

            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = "en-US";
            recognition.maxAlternatives = 3;

            recognition.onstart = function () {
              console.log("Voice recognition started");
            };

            recognition.onresult = function (event) {
              let finalTranscript = "";

              for (let i = event.resultIndex; i < event.results.length; i++) {
                if (event.results[i].isFinal) {
                  finalTranscript += event.results[i][0].transcript;
                }
              }

              // Process voice input but don't update visualization
              if (finalTranscript.trim() && !isSpeaking) {
                processVoiceInput(finalTranscript.toLowerCase());
              }
            };

            recognition.onerror = function (event) {
              console.log("Speech recognition error:", event.error);
            };

            recognition.onend = function () {
              if (isListening) {
                setTimeout(() => {
                  recognition.start();
                }, 100);
              }
            };

            recognition.start();
          } else {
            console.log("Speech recognition not supported");
          }
        }

        function processVoiceInput(userMessage) {
          console.log("User said:", userMessage);

          const keywords = [
            {
              patterns: ["hello", "halo", "ello", "helo"],
              responseKey: "hello",
            },
            {
              patterns: ["hi", "hai", "hey", "heyy", "heyyyy"],
              responseKey: "hi",
            },
            { patterns: ["hey", "heyy", "heyyyy", "hei"], responseKey: "hey" },
            {
              patterns: [
                "how are you",
                "how you",
                "how you dey",
                "how body",
                "how far",
                "you good",
                "wetin dey happen",
              ],
              responseKey: "how are you",
            },
            {
              patterns: ["how you dey", "how you day", "how you dey do"],
              responseKey: "how you dey",
            },
            {
              patterns: [
                "wetin dey happen",
                "what dey happen",
                "wetin dey",
                "what happening",
              ],
              responseKey: "wetin dey happen",
            },
            {
              patterns: ["how far", "how fa", "how farr"],
              responseKey: "how far",
            },
            {
              patterns: ["you good", "you dey good", "you okay"],
              responseKey: "you good",
            },
          ];

          let matchedResponseKey = null;

          for (const keyword of keywords) {
            for (const pattern of keyword.patterns) {
              if (userMessage.includes(pattern)) {
                matchedResponseKey = keyword.responseKey;
                break;
              }
            }
            if (matchedResponseKey) break;
          }

          if (matchedResponseKey) {
            setTimeout(function () {
              const aiResponse = generateResponse(matchedResponseKey);
              speakText(aiResponse);
            }, 500);
          }
        }

        function generateResponse(responseKey) {
          // Use mood responses
          if (
            moodResponses[currentMood] &&
            moodResponses[currentMood][responseKey]
          ) {
            return moodResponses[currentMood][responseKey];
          }

          // Fallback to default mood
          return (
            moodResponses.default[responseKey] ||
            "I hear you. How can I assist?"
          );
        }

        function speakText(text) {
          if (isSpeaking) {
            speechQueue.push(text);
            return;
          }

          isSpeaking = true;
          speech.text = text;

          speech.onstart = function () {
            // Visualization will automatically update due to isSpeaking flag
          };

          speech.onend = function () {
            isSpeaking = false;
            if (speechQueue.length > 0) {
              const nextText = speechQueue.shift();
              setTimeout(() => speakText(nextText), 500);
            }
          };

          speech.onerror = function () {
            isSpeaking = false;
          };

          window.speechSynthesis.speak(speech);
        }

        // Set appropriate voice based on selection
        window.speechSynthesis.onvoiceschanged = function () {
          const availableVoices = window.speechSynthesis.getVoices();
          const currentVoice = voices[currentVoiceIndex];

          let selectedVoice;

          if (currentVoice.name === "Sarah" || currentVoice.name === "Sofia") {
            selectedVoice = availableVoices.find(
              (voice) =>
                voice.name.toLowerCase().includes("female") ||
                voice.name.toLowerCase().includes("samantha") ||
                voice.name.toLowerCase().includes("karen") ||
                voice.name.toLowerCase().includes("victoria")
            );
          } else if (currentVoice.name === "Michael") {
            selectedVoice = availableVoices.find(
              (voice) =>
                voice.name.toLowerCase().includes("male") ||
                voice.name.toLowerCase().includes("deep") ||
                voice.name.toLowerCase().includes("david") ||
                voice.name.toLowerCase().includes("daniel")
            );
          } else {
            selectedVoice = availableVoices.find(
              (voice) =>
                voice.name.toLowerCase().includes("male") ||
                voice.name.toLowerCase().includes("alex") ||
                voice.name.toLowerCase().includes("tom")
            );
          }

          if (!selectedVoice && availableVoices.length > 0) {
            selectedVoice = availableVoices[0];
          }

          if (selectedVoice) speech.voice = selectedVoice;
        };
      });
    </script>
  </body>
</html>
